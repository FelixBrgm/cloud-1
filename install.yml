---
- name: Execute commands on remote hosts
  hosts: all
  remote_user: root
  tasks:
    - name: apt-get Update
      command: apt-get update
    - name: apt-get install docker
      command: apt-get install docker.io -y
    - name: apt-get install docker compose
      shell: |
        sudo apt-get update
        sudo apt-get install ca-certificates curl
        sudo install -m 0755 -d /etc/apt/keyrings
        sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
        sudo chmod a+r /etc/apt/keyrings/docker.asc

        echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}") stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
        sudo apt-get update

    - name: Installing docker compose really
      command: sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin -y

    - name: make directory
      command: bash -c "rm -rf /deployment && mkdir /deployment"

    - name: Create .ssh directory if it doesn't exist
      file:
        path: "/home/{{ ansible_user }}/.ssh"
        state: directory
        mode: '0700'
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
    - name: Copy private SSH key to the server
      copy:
        src: "./.ssh/id_rsa" 
        dest: "~/.ssh/id_rsa"
        mode: '0600' 
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"

    - name: Keyscan for github.com
      command: bash -c "ssh-keyscan github.com  >> ~/.ssh/known_hosts"
    - name: Clone inception repo
      command: git clone git@github.com:FelixBrgm/42-inception.git /deployment/incpetion
